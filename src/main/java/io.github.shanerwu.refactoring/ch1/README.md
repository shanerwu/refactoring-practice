## 重構，第一個案例
### 起點
> 如果你發現自己需要為程式添加一個特性，而程式碼結構使你無法很方便地那麼做，那就先重構那個程式，使特性的添加比較容易進行，然後再添加特性。

* 用戶希望以 HTML 格式列印報表，但無法重複使用 (reuse) Customer 的 `statement()`，需要編寫新的 `htmlStatement()`，且大量重複 `statement()` 中做的事情。
* 若用戶希望可以改變影片的分類規則，而這會影響顧客消費和常客累積的計算方式。為了應付這些改變，除了修改 `statement()`，還要一併修改 `htmlStatement()`。
* 隨著規則變得越來越複雜，犯錯的機會也會越來越多。

### 重構的第一步
> 建立可靠的測試機制，而這些測試必須要有自我檢驗（self-checking）的能力。

* 進行重構時，需要倚賴測試。
* `Customer.statement()` 回傳結果是字串，所以可以這樣做測試：
    1. 建立測試顧客。
    2. 讓每個顧客各租幾部不同的影片。
    3. 產生報表字串。
    4. 用新的字串和已經檢查過的參考字串做比較。
* 測試必須讓測試有能力自我檢驗。
* 花點時間建立一個優良的測試機制是非常值得的。